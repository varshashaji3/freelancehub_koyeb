{% load static %}
{% load custom_filters %}
<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  {% load static %}
  <title>FreelanceHub</title>
  <!-- plugins:css -->
  <link rel="stylesheet" href="{%  static 'vendors/feather/feather.css'  %}">
  <link rel="stylesheet" href="{%  static 'vendors/ti-icons/css/themify-icons.css' %}">
  <link rel="stylesheet" href="{%  static 'vendors/css/vendor.bundle.base.css' %}">
  <!-- endinject -->
  <!-- Plugin css for this page -->
  <link rel="stylesheet" href="{%  static 'vendors/datatables.net-bs4/dataTables.bootstrap4.css' %}">
  <link rel="stylesheet" href="{%  static 'vendors/ti-icons/css/themify-icons.css' %}">
  <link rel="stylesheet" type="text/css" href="{%  static 'js/select.dataTables.min.css' %}">
  <!-- End plugin css for this page -->
  <!-- inject:css -->
  <link rel="stylesheet" href="{%  static 'css/vertical-layout-light/style.css' %}">
  <!-- endinject -->
  <link rel="shortcut icon" href="{%  static 'images/favicon.png' %}" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    /* Chatbot styles */
    #chatbox {
        position: fixed;
        bottom: 20px;
        right: 20px;
        width: 300px;
        border: 1px solid #ccc;
        border-radius: 8px;
        background-color: #fff;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: none; /* Initially hidden */
        z-index: 1000;
    }
    #messages {
        max-height: 200px;
        overflow-y: auto;
        padding: 10px;
    }
    #user_input {
        width: calc(100% - 60px);
        padding: 10px;
    }
    #send_button {
        padding: 10px;
    }
  </style>
</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>



<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script>
  toastr.options = {
    "closeButton": true,
    "debug": false,
    "newestOnTop": true,
    "progressBar": true,
    "positionClass": "toast-top-right",
    "preventDuplicates": true,
    "onclick": null,
    "showDuration": "300",
    "hideDuration": "1000",
    "timeOut": "5000",
    "extendedTimeOut": "1000",
    "showEasing": "swing",
    "hideEasing": "linear",
    "showMethod": "fadeIn",
    "hideMethod": "fadeOut"
  };
</script>
<style>
  

  .modal {
      
    left: 0;
    top: 0;
    background-color: rgba(0, 0, 0, 0.5); 
    
  }



  .modal-content {
    background-color: #fefefe; /* White background */
    margin: 5% auto; /* Centered */
    padding: 20px;
    border: 1px solid #888; /* Light gray border */
    width: 80%; /* Width of the modal */
    max-width: 600px; /* Max width of the modal */
    border-radius: 8px; /* Rounded corners */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Shadow effect */
   
  }
  
  /* Close Button */
  .close-button {
    color: #aaa; /* Gray color */
    float: right; /* Right-align */
    font-size: 28px; /* Large font size */
    font-weight: bold; /* Bold text */
    cursor: pointer; /* Pointer cursor */
  }
  
  .close-button:hover,
  .close-button:focus {
    color: black; /* Darker color on hover/focus */
    text-decoration: none; /* No underline */
  }
  
  /* Modal Header */
  .modal-content h2 {
    margin: 0 0 10px; /* Margin at bottom */
    font-size: 24px; /* Font size */
    color: #333; /* Dark gray color */
    text-align: center; /* Center-align text */
  }
  
  /* Modal Image */
  .modal-image {
    display: block; /* Block-level element */
    max-width: 100%; /* Responsive width */
    height: 200px; /* Maintain aspect ratio */
    margin: 0 auto; /* Center the image */
  }
  
  /* Form Styles */
  #reviewForm {
    display: flex;
    flex-direction: column; /* Stack elements vertically */
    gap: 15px; /* Space between elements */
  }
  
  /* Textarea */
  #reviewForm textarea {
    width: 100%; /* Full width */
    height: 100px; /* Height */
    padding: 10px; /* Padding */
    border: 1px solid #ccc; /* Light border */
    border-radius: 4px; /* Rounded corners */
    resize: vertical; /* Allow vertical resizing */
  }
  
 
  

  .star-rating {
    display: flex;
    flex-direction: row-reverse;
    justify-content: center;
    margin: 10px 0;
}

.star-rating input[type="radio"] {
    display: none;
}

.star-rating label {
    font-size: 2rem;
    color: #ccc;
    cursor: pointer;
    transition: color 0.3s;
    margin: 0 5px;
}

.star-rating label:hover,
.star-rating label:hover ~ label {
    color: #ffca08;
}

.star-rating input[type="radio"]:checked ~ label {
    color: #ffca08;
}


  
  
  /* Submit Button */
  #reviewForm button {
    background-color: #4CAF50; /* Green background */
    color: white; /* White text */
    border: none; /* Remove border */
    padding: 10px 20px; /* Padding */
    text-align: center; /* Center text */
    text-decoration: none; /* Remove underline */
    display: inline-block; /* Inline-block */
    font-size: 16px; /* Font size */
    border-radius: 4px; /* Rounded corners */
    cursor: pointer; /* Pointer cursor */
  }
  
  #reviewForm button:hover {
    background-color: #45a049; /* Darker green on hover */
  }

  .close-button {
        color: white;
        cursor: pointer;
        font-size: 20px;
    }

    .close-button:hover {
        color: #ffdddd;
    }

    .chat-toggle-button {
        background-color: #007bff;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
    }

    /* Floating animation */
    @keyframes float {
        0% { transform: translatey(0); }
        50% { transform: translatey(-10px); }
        100% { transform: translatey(0); }
    }

    .floating {
        animation: float 2s ease-in-out infinite;
    }
</style>

<script>
  $(document).ready(function () {

    $("#title").keyup(function () {
      check_title();
    })

    var title_error = false;

    function check_title() {
      var pattern = /^[a-zA-Z ]*$/;
      var title = $("#title").val();
      if (pattern.test(title) && title !== "") {
        $("#error_title").hide();
        $("#title").css("border", "2px solid green");
      } else {
        $("#error_title").html("Should contain only letters").show();
        $("#title").css("border", "2px solid red");
        title_error = true;
      }
    }



    $("#project_form").submit(function () {

      title_error = false;
      check_title();

      if (title_error) {
        $("#todo_err").html("Please fill the form correctly.").show();
        return false;
      } else {
        $("#todo_err").hide();
        return true;
      }
    });
  });
</script>

<body>
  <div class="container-scroller">
    <!-- partial:partials/_navbar.html -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
        <a class="navbar-brand brand-logo mr-5" href="#"><img src="{% static 'img/logo.png' %}" class="mr-2"
            alt="logo" /></a><a class="navbar-brand brand-logo-mini" href="#"><img src="{% static 'img/logo2.png' %}"
            alt="logo" /></a>
      </div>
      <div class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
        <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
          <span class="icon-menu"></span>
        </button>
        <ul class="navbar-nav mr-lg-2">
          <!-- Remove these items from here -->
        </ul>
        <ul class="navbar-nav navbar-nav-right">
          <li class="nav-item">
            <a href="{% url 'freelancer:plans' %}" id="upgradeBtn" class="btn btn-warning" style="margin-right: 15px;">
              Upgrade
          </a>
        </li>
          <!-- Add this new list item for the Open to Work button -->
          <li class="nav-item">
              <button id="openToWorkBtn" class="btn {% if freelancer.is_open_to_work %}btn-success{% else %}btn-primary{% endif %}" style="margin-right: 15px;">
                  <i class="fas fa-briefcase"></i> {% if freelancer.is_open_to_work %}Not Open to Work{% else %}Open to Work{% endif %}
              </button>
          </li>
          
          <!-- Existing notification dropdown and other items -->
          <li class="nav-item dropdown">
            <a class="nav-link count-indicator dropdown-toggle" id="notificationDropdown" href="#" data-toggle="dropdown">
                <i class="icon-bell mx-0"></i>
                <span style="margin-left:8px;color:white; font-size:10px;background-color:rgb(14, 14, 160);margin-top:-5px;height:16px;width:16px;" class="count">{{ unread_notifications.count }}</span>
            </a>
            <div class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list" aria-labelledby="notificationDropdown">
                <p class="mb-0 font-weight-normal float-left dropdown-header">Notifications</p>
                {% for notification in unread_notifications %}
                <a class="dropdown-item preview-item">
                    <div class="d-flex align-items-center">
                        <div class="preview-thumbnail">
                            <div class="preview-icon bg-success">
                                <i class="ti-info-alt mx-0"></i>
                            </div>
                        </div>
                        <div class="preview-item-content flex-grow-1">
                            <h6 class="preview-subject font-weight-normal">{{ notification.message }}</h6>
                            <p class="font-weight-light small-text mb-0 text-muted">
                                {{ notification.created_at|timesince }} ago
                            </p>
                        </div>
                        <form action="{% url 'freelancer:notification_mark_as_read' notification.id %}" method="post">
                          {% csrf_token %}
                          <input type="submit" class="btn btn-success btn-sm" value="Mark as Read">
                      </form>
                    </div>
                </a>
                {% endfor %}
                {% if not unread_notifications %}
                <p class="font-weight-light small-text mb-0 text-muted">No unread notifications</p>
                {% endif %}
            </div>
        </li>




          <li class="nav-item nav-search d-none d-lg-block">
            <p>Hi ,{{ profile2.first_name }}</p>
          </li>
          <li class="nav-item nav-profile dropdown">
            <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown" id="profileDropdown">
              {% if profile2.profile_picture %}
              <img src="{{ profile2.profile_picture.url }}" alt="profile" />
              {% else %}
              <img src="{% static 'path/to/default/image.jpg' %}" alt="profile" />
              {% endif %}
            </a>
            <div class="dropdown-menu dropdown-menu-right navbar-dropdown" aria-labelledby="profileDropdown">
              <a class="dropdown-item" href="{% url 'freelancer:account_settings' %}">
                <i class="ti-user text-primary"></i>
                Profile
              </a>
             
              <a class="dropdown-item" href="{% url 'logout' %}">
                <i class="ti-power-off text-primary"></i>
                Logout
              </a>

            </div>
          </li>
          <!-- <li class="nav-item nav-settings d-none d-lg-flex">
            <a class="nav-link" href="#">
              <i class="icon-ellipsis"></i>
            </a>
          </li> -->
          <!-- Add this new list item for the review button -->
        
        </ul>
        <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button"
          data-toggle="offcanvas">
          <span class="icon-menu"></span>
        </button>
      </div>
    </nav>
    <!-- partial -->
    <div class="container-fluid page-body-wrapper">

      <div id="right-sidebar" class="settings-panel">
        <i class="settings-close ti-close"></i>
        <ul class="nav nav-tabs border-top" id="setting-panel" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" id="todo-tab" data-toggle="tab" href="#todo-section" role="tab"
              aria-controls="todo-section" aria-expanded="true">TO DO LIST</a>
          </li>
          <!-- <li class="nav-item">
            <a class="nav-link" id="chats-tab" data-toggle="tab" href="#chats-section" role="tab" aria-controls="chats-section">CHATS</a>
          </li> -->
        </ul>
        <div class="tab-content" id="setting-content">
          <div class="tab-pane fade show active scroll-wrapper" id="todo-section" role="tabpanel"
            aria-labelledby="todo-section">
            <div class="add-items d-flex px-3 mb-0">
              <form class="form w-100" method="post" action="{% url 'freelancer:add_todo' %}"
                id="todo_form">
                {% csrf_token %}
                <div class="form-group d-flex">
                  <input type="hidden" name="next" value="{{ request.path }}">
                  <input type="text" class="form-control todo-list-input" name="title" id="title"
                    placeholder="Add To-do">
                  <br><span id="error_title" class="error"></span>

                  <button type="submit" class="add btn btn-primary" id="add-task">Add</button>
                  <br><span id="todo_err" class="error"></span>
                </div>
              </form>
            </div>
            <div class="list-wrapper px-3">
              <ul class="d-flex flex-column-reverse todo-list">
                {% for todo in todos %}
                <li>
                  <div class="form-check">
                    <label class="form-check-label">
                      <input class="checkbox" type="checkbox">
                      {{todo.title}}
                    </label>
                  </div>
                  <form action="{% url 'freelancer:delete_todo' todo.id %}" method="post" style="display: inline;">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path }}">
                    <button type="submit" style=" border:none;outline:none;background-color: #fff;padding-left:130px">
                      <i class="remove ti-trash"></i>
                    </button>
                  </form>
                </li>
                {% endfor %}
              </ul>
            </div>

          </div>
          <!-- To do section tab ends -->

        </div>
      </div>
      <!-- partial -->
      <!-- partial:partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar" style="margin-left:-13px;">
        <ul class="nav">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'freelancer:freelancer_view' %}">
              <i class="fas fa-tachometer-alt menu-icon"></i> <!-- Dashboard Icon -->
              <span class="menu-title">Dashboard</span>
            </a>
          </li>
         
      
          <li class="nav-item">
            <a class="nav-link" href="{% url 'freelancer:account_settings' %}">
              <i class="fas fa-user menu-icon"></i> <!-- Account Icon -->
              <span class="menu-title">Account</span>
            </a>
          </li>
      
          
          <li class="nav-item">
            <a class="nav-link" href="{% url 'freelancer:analyze_skill_gap' %}">
              <i class="fas fa-chart-line menu-icon"></i> <!-- Skill Analysis Icon -->
              <span class="menu-title">Skill Analysis</span>
            </a>
          </li>

          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#projects" aria-expanded="false" aria-controls="ui-basic">
              <i class="fas fa-folder menu-icon"></i> <!-- Complaints Icon -->
              <span class="menu-title">Manage Projects</span>
              <i class="menu-arrow"></i>
            </a>
            <div class="collapse" id="projects">
              <ul class="nav flex-column sub-menu">
                <li class="nav-item"> <a class="nav-link"  href="{% url 'freelancer:view_project' %}">Available Projects</a></li>
                <li class="nav-item"> <a class="nav-link" href="{% url 'freelancer:view_created_proposals' %}">My Project Proposals</a>
                </li>
                <li class="nav-item"> <a class="nav-link" href="{% url 'freelancer:freelancer_repositories' %}">Project Repositories</a>
                </li>
              </ul>
            </div>
          </li>
          

          <!-- <li class="nav-item">
            <a class="nav-link" href="{% url 'freelancer:tasks_list' %}">
              <i class="fas fa-tasks menu-icon"></i> <!-- Tasks Icon -->
              <!-- <span class="menu-title">Tasks</span>
            </a>
          </li> --> 
      
          <!-- <li class="nav-item">
            <a class="nav-link" href="{% url 'freelancer:client_list' %}">
              <i class="fas fa-users menu-icon"></i>
              <span class="menu-title">Clients</span>
            </a>
          </li>
       -->
          <li class="nav-item">
            <a class="nav-link" href="{% url 'freelancer:todo' %}">
              <i class="fas fa-clipboard-list menu-icon"></i> <!-- Todo Icon -->
              <span class="menu-title">Todo</span>
            </a>
          </li>
      
          <li class="nav-item">
            <a class="nav-link" href="{% url 'freelancer:calendar' %}">
              <i class="far fa-calendar-alt menu-icon"></i> <!-- Calendar Icon -->
              <span class="menu-title">Calendar</span>
            </a>
          </li>
      
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#portfolio" aria-expanded="false" aria-controls="ui-basic">
              <i class="fas fa-briefcase menu-icon"></i> <!-- Complaints Icon -->
              <span class="menu-title">Portfolio</span>
              <i class="menu-arrow"></i>
            </a>
            <div class="collapse" id="portfolio">
              <ul class="nav flex-column sub-menu">
                <li class="nav-item"> <a class="nav-link" href="{% url 'freelancer:my_portfolios' %}">My Portfolio</a></li>
                <li class="nav-item"> <a class="nav-link" href="{% url 'freelancer:template_list' %}">Create Portfolio</a>
                </li>
              </ul>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'freelancer:payments' %}">
                <i class="fas fa-calculator menu-icon"></i> <!-- Payment Icon -->
                <span class="menu-title">Payments</span>
            </a>
        </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'freelancer:chat_view' %}">
              <i class="fas fa-comments menu-icon"></i> <!-- Chat Icon -->
              <span class="menu-title">Chat</span>
            </a>
          </li>
      
          <li class="nav-item">
            <a class="nav-link" data-toggle="collapse" href="#complaints" aria-expanded="false" aria-controls="ui-basic">
              <i class="fas fa-exclamation-circle menu-icon"></i> <!-- Complaints Icon -->
              <span class="menu-title">Complaints</span>
              <i class="menu-arrow"></i>
            </a>
            <div class="collapse" id="complaints">
              <ul class="nav flex-column sub-menu">
                <li class="nav-item"> <a class="nav-link" href="{% url 'freelancer:add_complaint' %}">Add Complaint</a>
                  
                <li class="nav-item"> <a class="nav-link" href="{% url 'freelancer:view_complaints' %}">Submitted</a></li>
                
                <li class="nav-item"> <a class="nav-link" href="{% url 'freelancer:view_complaints_recieved' %}">Received</a></li>
                </li>
              </ul>
            </div>
          </li>
      
          <li class="nav-item">
            <a class="nav-link" href="{% url 'freelancer:my_teams' %}">
              <i class="fas fa-users-cog menu-icon"></i> <!-- Team Management Icon -->
              <span class="menu-title">Manage Team</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'freelancer:events_and_quizzes_view' %}">
              <i class="fas fa-calendar-check menu-icon"></i> <!-- Events & Quizzes Icon -->
              <span class="menu-title">Events & Quizzes</span>
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="{% url 'logout'%}">
              <i class="fas fa-sign-out-alt menu-icon"></i> <!-- Logout Icon -->
              <span class="menu-title">Logout</span>
            </a>
          </li>

          
        </ul>
      </nav>
      
      <!-- partial -->
      <div class="main-panel">
        <div class="content-wrapper">
          
          {% block 'freelancer_content' %}
          

          {% endblock %}
        </div>
      </div>
      <!-- main-panel ends -->
    </div>
    <!-- page-body-wrapper ends -->
  </div>
  <!-- container-scroller -->





 
  <div id="siteReviewModal" class="modal">
    <div class="modal-content">
        <h2>We Value Your Feedback</h2>
        <img src="{% static 'img/review.png' %}" alt="Feedback Image" class="modal-image">
        <form id="reviewForm" method="post" action="{% url 'site_review' %}?next={{ request.path }}">
            {% csrf_token %}
            <textarea name="review_text" placeholder="Your review" required></textarea>
            <p>Please rate your experience with FreelanceHub on a scale from 1 to 5</p>
            <div class="star-rating">
              <input type="radio" id="star5" name="rating" value="5">
              <label for="star5" title="5 stars">&#9733;</label>
              <input type="radio" id="star4" name="rating" value="4">
              <label for="star4" title="4 stars">&#9733;</label>
              <input type="radio" id="star3" name="rating" value="3">
              <label for="star3" title="3 stars">&#9733;</label>
              <input type="radio" id="star2" name="rating" value="2">
              <label for="star2" title="2 stars">&#9733;</label>
              <input type="radio" id="star1" name="rating" value="1">
              <label for="star1" title="1 star">&#9733;</label>
            </div>
            
          
            <button type="submit">Submit Review</button>
        </form>
    </div>
  </div>
  
  
  
  <script>
    $(document).ready(function () {
      const reviewDue = "{{ review_due }}";
      const modal = document.getElementById('siteReviewModal');
      const closeButton = document.getElementById('.close-button');
    
  
      if (reviewDue === 'True') {
        modal.style.display = 'block';
      }
    
      closeButton.addEventListener('click', function () {
        modal.style.display = 'none';
      });
    
      window.addEventListener('click', function (event) {
        if (event.target === modal) {
          modal.style.display = 'none';
        }
      });
  });
  
  </script>









    <script>
      $(document).ready(function () {
        {% if project_status.status == 'Completed' and not project_status.freelancer_review_given %}
          // Log the project status data to console
          console.log('Project Status Data:');
          console.log('Freelancer Name:', '{{ project_status.freelancer_name }}');
          console.log('Client Name:', '{{ project_status.client_name }}');
          console.log('Project ID:', '{{ project_status.project_id }}');
          console.log('Freelancer ID:', '{{ project_status.freelancer_id }}');
          console.log('Project Title:', '{{ project_status.project_title }}');
          console.log('Client ID:', '{{ project_status.client_id }}');

          // Set the values in the modal
          $('#freelancerName').text('{{ project_status.freelancer_name }}');
          $('#clientName').text('{{ project_status.client_name }}');
          $('#projectId').val('{{ project_status.project_id }}');
          $('#freelancerId').val('{{ project_status.freelancer_id }}');
          $('#title').text('{{ project_status.project_title }}');
          $('#clientId').val('{{ project_status.client_id }}');

          // Show the modal
          $('#reviewModal').modal('show');
        {% else %}
          console.log('No project status data available or review already given.');
        {% endif %}
      });
      </script>
      <!-- <script>
        $(document).ready(function() {
          $("#reviewForm").submit(function(event) {
              var isValid = validateForm();
              if (!isValid) {
                  event.preventDefault(); // Prevent form submission if validation fails
              }
          });
      
          // Real-time validation
          $("#overallRating").change(validateRating);
          $("#review").keyup(validateReview);
      
          function validateForm() {
              var isValidRating = validateRating();
              var isValidReview = validateReview();
              return isValidRating && isValidReview;
          }
      
          function validateRating() {
              var overallRating = $("#overallRating").val();
              if (overallRating == "0") {
                  $("#overallRatingError").html("Please select a rating").show();
                  $("#overallRating").css("border", "2px solid red");
                  return false;
              } else {
                  $("#overallRatingError").hide();
                  $("#overallRating").css("border", "2px solid green");
                  return true;
              }
          }
      
          function validateReview() {
              var review = $("#review").val();
              var reviewRegex = /^(?!\s)(?!.*\s{2})(?!.*\d{3})(?!.*\s$)[A-Za-z\d\s.,!?]{10,}$/;
              
              if (review.trim() === "") {
                  $("#reviewError").html("Please enter a review").show();
                  $("#review").css("border", "2px solid red");
                  return false;
              } else if (!reviewRegex.test(review)) {
                  $("#reviewError").html("Review format is invalid. Please check the guidelines.").show();
                  $("#review").css("border", "2px solid red");
                  return false;
              } else {
                  $("#reviewError").hide();
                  $("#review").css("border", "2px solid green");
                  return true;
              }
          }
      
          // Validate on button click
          $("button[type='submit']").click(function(event) {
              if (!validateForm()) {
                  event.preventDefault();
              }
          });
      });
      </script> -->

      <div class="modal fade" id="reviewModal" tabindex="-1" role="dialog" aria-labelledby="reviewModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="reviewModalLabel">Submit Review for Client: <span id="clientName"></span></h5>
              <br>
              <p>Freelancer: <span id="freelancerName"></span></p><br>
              <p>Project Title: <span id="title"></span></p>
              
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <form id="reviewForm" action="{% url 'freelancer:submit_user_review' %}" method="POST">
              {% csrf_token %}
              <div class="modal-body">
                <div class="form-group">
                  <label for="overallRating">Overall Rating:</label>
                  <select name="overall_rating" class="form-control" id="overallRating" required>
                    <option value="0">Select Rating</option>
                    <option value="1">1 - Poor</option>
                    <option value="2">2 - Fair</option>
                    <option value="3">3 - Good</option>
                    <option value="4">4 - Very Good</option>
                    <option value="5">5 - Excellent</option>
                </select>
                <span id="overallRatingError" class="error"></span>
              </div>
                <div class="form-group">
                  <label for="review">Review:</label>
                  <textarea class="form-control" id="review" name="review" rows="3" required></textarea>
                  <span id="reviewError" class="error"></span>
                </div>
                <input type="hidden" id="projectId" name="project_id" value="">
                <input type="hidden" id="freelancerId" name="freelancer_id" value="">
                <input type="hidden" id="clientId" name="client_id" value="">
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary">Submit Review</button>
              </div>
            </form>
          </div>
        </div>
      </div>
      




      {% if has_refund_payment %}
      <div id="paymentDetailsModal" class="modal" tabindex="-1" role="dialog" style="display: none;" data-backdrop="static" data-keyboard="false">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title">Payment Details</h5>
                      <!-- Remove the close button from the header -->
                  </div>
                  <div class="modal-body">
                      <p>Total Paid: {{ refund_payment.total_paid }}</p>
                      <p>Amount Due: {{ refund_payment.amount }}</p>
                      <p>Compensation Amount: {{ refund_payment.compensation_amount }}</p>
                      <p>Refund Payment To: {{ refund_payment.pay_to }}</p>
                  </div>
                  <div class="modal-footer">
                      <button id="payButton" type="button" class="btn btn-primary" onclick="makePayment({{ refund_payment.amount }}, '{{ refund_payment.pay_to.id }}')">Pay Now</button>
                      <!-- Remove the close button from the footer -->
                  </div>
              </div>
          </div>
      </div>
  {% endif %}
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      {% if has_refund_payment and not refund_payment.is_paid %}
          $('#paymentDetailsModal').modal({
              backdrop: 'static',
              keyboard: false
          });
      {% endif %}
  
      document.getElementById("payButton").addEventListener("click", function() {
          console.log("Pay button clicked, initiating Razorpay payment.");
  
          var options = {
              "key": "{{ razorpay_key }}",
              "amount": "{{ amount_in_paisa }}",
              "currency": "INR",
              "name": "Refund Payment",
              "description": "Refund Payment to {{ refund_payment.pay_to }}",
              "order_id": "{{ razorpay_order_id }}",
              "handler": function (response) {
                  console.log("Payment successful, sending AJAX request.");
                  
                  $.ajax({
                      url: "{% url 'payment_success' %}",
                      method: "POST",
                      data: {
                          payment_id: response.razorpay_payment_id,
                          order_id: response.razorpay_order_id,
                          signature: response.razorpay_signature,
                          refund_payment_id: "{{ refund_payment.id }}",
                          csrfmiddlewaretoken: '{{ csrf_token }}'
                      },
                      success: function(data) {
                        $('#paymentDetailsModal').modal('hide');
                        
                          console.log("Payment success AJAX response:", data);
                          
                          // Create a confetti canvas with a high z-index
                          const confettiCanvas = document.createElement('canvas');
                          confettiCanvas.style.position = 'fixed';
                          confettiCanvas.style.top = '0';
                          confettiCanvas.style.left = '0';
                          confettiCanvas.style.width = '100%';
                          confettiCanvas.style.height = '100%';
                          confettiCanvas.style.zIndex = '9999'; // Ensure it's on top
                          document.body.appendChild(confettiCanvas);
  
                          const myConfetti = confetti.create(confettiCanvas, {
                              resize: true,
                              useWorker: true
                          });
  
                          myConfetti({
                              particleCount: 1000,
                              spread: 160,
                              startVelocity: 60,
                              origin: { y: 0.6 }
                          });
  
                          // Remove the confetti canvas after 3 seconds
                          setTimeout(() => {
                              document.body.removeChild(confettiCanvas);
                          }, 3000);
  
                          Swal.fire({
                              title: 'Payment Successful!',
                              text: 'Thank you for your payment.',
                              icon: 'success',
                              confirmButtonText: 'OK'
                          }).then(() => {
                              location.reload(); // Reload the page
                          });
                      },
                      error: function(err) {
                          console.error("Payment verification failed", err);
                          alert('Payment verification failed');
                      }
                  });
              },
              "prefill": {
                  "name": "{{ request.user.name }}",
                  "email": "{{ request.user.email }}",
                  "contact": ""  // Add contact if available
              },
              "theme": {
                  "color": "#41436A"
              }
          };
  
          var rzp1 = new Razorpay(options);
          rzp1.open();
      });
      
  });
  </script>







  <!-- plugins:js -->
  <script src="{%  static 'vendors/js/vendor.bundle.base.js' %}"></script>
  <!-- endinject -->
  <!-- Plugin js for this page -->
  <script src="{%  static 'vendors/chart.js/Chart.min.js' %}"></script>
  <script src="{%  static 'vendors/datatables.net/jquery.dataTables.js' %}"></script>
  <script src="{%  static 'vendors/datatables.net-bs4/dataTables.bootstrap4.js' %}"></script>
  <script src="{%  static 'js/dataTables.select.min.js' %}"></script>

  <!-- End plugin js for this page -->
  <!-- inject:js -->
  <script src="{%  static 'js/off-canvas.js' %}"></script>
  <script src="{%  static 'js/hoverable-collapse.js' %}"></script>
  <script src="{%  static 'js/template.js' %}"></script>
  <script src="{%  static 'js/settings.js' %}"></script>
  <script src="{%  static 'js/todolist.js' %}"></script>
  <!-- endinject -->
  <!-- Custom js for this page-->
  <script src="{%  static 'js/dashboard.js' %}"></script>
  <script src="{%  static 'js/Chart.roundedBarCharts.js' %} "></script>
  <!-- End custom js for this page-->

  <!-- Chat Button -->
  <div id="supportChatButton" class="chat-toggle-button floating" style="position: fixed; bottom: 40px; right: 20px; z-index: 1000; background-color: #063970; transition: transform 0.3s; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);">
    <img src="{% static 'img/robot-assistant.png' %}" alt="Chat" style="width: 50px; height: 50px;" id="chatIcon">
</div>
<div id="closeChatButton" class="chat-toggle-button" style="display: none; position: fixed; bottom: 40px; right: 20px; z-index: 1000; background-color: #063970; transition: transform 0.3s; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);">
    <span class="close-button" style="font-size: 28px; cursor: pointer;">&times;</span>
</div>
  <div id="supportChatWidget" class="chat-widget" style="display: none; position: fixed; bottom: 90px; right: 20px; width: 350px; height: 400px; background: white; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.1); z-index: 1000; overflow: hidden;">
      <!-- Chat Header -->
      <div class="chat-header" style="background-color: #063970; color: white; padding: 15px; display: flex; align-items: center; justify-content: space-between;">
          <div style="display: flex; align-items: center; gap: 10px;">
              <img src="{% static 'img/robot-assistant.png' %}" alt="Bot Avatar" style="width: 30px; height: 30px; border-radius: 50%;">
              <span style="font-weight: bold;">FreelanceHub Assistant</span>
          </div>
          <span id="closeChatButton" style="cursor: pointer; font-size: 20px;">&times;</span>
      </div>

      <!-- Chat Body -->
      <div class="chat-body" style="height: calc(100% - 180px); background-color: #f8f9fa; overflow-y: auto; padding: 15px;">
          <div id="chat-messages">
              <!-- Messages will appear here -->
              <div class="bot-message" style="font-size: 13px;">
                  Hi! I'm FreelanceHub Assistant. How can I help you today?
              </div>
          </div>
      </div>

      <!-- Chat Input Area -->
      <div class="chat-input-area" style="padding: 15px; background-color: #fff; border-top: 1px solid #dee2e6;">
          <div style="display: flex; gap: 10px;">
              <input type="text" id="user-input" placeholder="Type your message..." 
                     style="flex-grow: 1; padding: 10px; border: 1px solid #dee2e6; border-radius: 5px; outline: none;">
              <button id="send-button" 
                      style="background-color: #063970; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">
                  Send
              </button>
          </div>
      </div>

      <!-- Chat Footer -->
      <div class="chat-footer" style="padding: 5px; text-align: center; background-color: #f8f9fa; border-top: 1px solid #dee2e6;">
          <small style="color: #6c757d;">Powered by FreelanceHub</small>
      </div>
  </div>

  <style>
      /* Animation for chat widget */
      @keyframes slideIn {
          from {
              transform: translateX(100%);
              opacity: 0;
          }
          to {
              transform: translateX(0);
              opacity: 1;
          }
      }

      @keyframes slideOut {
          from {
              transform: translateX(0);
              opacity: 1;
          }
          to {
              transform: translateX(100%);
              opacity: 0;
          }
      }

      #supportChatWidget {
          animation: slideIn 0.3s ease-out;
      }

      #supportChatWidget.hiding {
          animation: slideOut 0.3s ease-in;
      }

      /* Hover effect for chat button */
      #supportChatButton:hover {
          transform: scale(1.1);
          transition: transform 0.2s ease;
      }

      /* Responsive design */
      @media (max-width: 480px) {
          #supportChatWidget {
              width: 90%;
              right: 5%;
              bottom: 80px;
          }
          
          #supportChatButton {
              bottom: 20px;
              right: 10px;
          }
      }

      /* Message Styles */
      .bot-message, .user-message {
          margin-bottom: 15px;
          padding: 10px 15px;
          border-radius: 15px;
          max-width: 80%;
          word-wrap: break-word;
      }

      .bot-message {
          background-color: #e9ecef;
          color: #212529;
          margin-right: auto;
          border-bottom-left-radius: 5px;
      }

      .user-message {
          background-color: #063970;
          color: white;
          margin-left: auto;
          border-bottom-right-radius: 5px;
      }

      #user-input:focus {
          border-color: #063970;
          box-shadow: 0 0 0 2px rgba(6, 57, 112, 0.1);
      }

      #send-button:hover {
          background-color: #052c56;
      }

      /* Loading Animation */
      .typing-indicator {
          background-color: #e9ecef;
          padding: 10px 15px;
          border-radius: 15px;
          margin-bottom: 15px;
          display: none;
      }

      .typing-indicator span {
          display: inline-block;
          width: 8px;
          height: 8px;
          background-color: #6c757d;
          border-radius: 50%;
          margin-right: 5px;
          animation: typing 1s infinite;
      }

      .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
      .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }

      @keyframes typing {
          0%, 100% { transform: translateY(0); }
          50% { transform: translateY(-5px); }
      }
  </style>

  <script>
  $(document).ready(function() {
    $("#supportChatButton").click(function () {
            $("#supportChatWidget").toggle();
            $("#supportChatButton").hide();
            $("#closeChatButton").show();
        });

      $("#closeChatButton, #closeChatHeader").click(function() {
          $("#supportChatWidget").addClass('hiding');
          setTimeout(function() {
              $("#supportChatWidget").hide().addClass('hiding');
              $("#supportChatButton").show();
              
            $("#closeChatButton").hide();
          }, 290);
      });

      // Handle window resize
      $(window).resize(function() {
          if ($(window).width() <= 480) {
              $("#supportChatWidget").css({
                  'width': '90%',
                  'right': '5%'
              });
          } else {
              $("#supportChatWidget").css({
                  'width': '350px',
                  'right': '20px'
              });
          }
      });

      // Add typing indicator to chat
      $('#chat-messages').append(`
          <div class="typing-indicator">
              <span></span>
              <span></span>
              <span></span>
          </div>
      `);

      // Handle send button click
      $('#send-button').click(sendMessage);

      // Handle enter key press
      $('#user-input').keypress(function(e) {
          if (e.which == 13) { // Enter key
              sendMessage();
          }
      });

      function sendMessage() {
          const userInput = $('#user-input').val().trim();
          if (!userInput) return;

          // Add user message to chat
          $('#chat-messages').append(`
              <div class="user-message">${userInput}</div>
          `);
          
          // Clear input field
          $('#user-input').val('');

          // Add typing indicator below user message
          $('#chat-messages').append(`
              <div class="typing-indicator">
                  <span></span>
                  <span></span>
                  <span></span>
              </div>
          `);
          scrollToBottom();

          // Send to backend
          $.ajax({
              url: '/chatbot/chat/',
              type: 'POST',
              contentType: 'application/json',
              data: JSON.stringify({ message: userInput }),
              success: function(data) {
                  setTimeout(() => {
                      $('.typing-indicator').remove(); // Remove instead of hide
                      $('#chat-messages').append(`
                          <div class="bot-message" style="font-size: 13px;">${data.response}</div>
                      `);
                      scrollToBottom();
                  }, 1000);
              },
              error: function() {
                  setTimeout(() => {
                      $('.typing-indicator').remove(); // Remove instead of hide
                      $('#chat-messages').append(`
                          <div class="bot-message" style="background-color: #ffebee; color: #c62828; font-size: 13px;">
                              Sorry, I couldn't process your request. Please try again.
                          </div>
                      `);
                      scrollToBottom();
                  }, 1000);
              }
          });
      }

      function scrollToBottom() {
          const chatBody = $('.chat-body');
          chatBody.scrollTop(chatBody[0].scrollHeight);
      }

      // Focus input when chat opens
      $("#supportChatButton").click(function() {
          setTimeout(() => {
              $('#user-input').focus();
          }, 300);
      });
  });
  </script>

  <!-- Add this script before the closing body tag -->
  <script>
    $(document).ready(function() {
        $('#openToWorkBtn').click(function() {
            const isOpenToWork = $(this).hasClass('btn-success'); // Check current status
            const confirmationText = isOpenToWork 
                ? 'Are you sure you want to mark yourself as not open to work?' 
                : 'Are you sure you want to mark yourself as open to work?';

            Swal.fire({
                title: 'Toggle Work Status',
                text: confirmationText,
                icon: 'question',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: isOpenToWork ? 'Yes, mark as not open!' : 'Yes, mark as open!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {
                    const newStatus = isOpenToWork ? 'close' : 'open'; // Determine new status
                    $.ajax({
                        url: '{% url "freelancer:toggle_open_to_work" %}',  // Update this line
                        type: 'POST',
                        data: {
                            'csrfmiddlewaretoken': '{{ csrf_token }}',
                            'status': newStatus
                        },
                        success: function(response) {
                            if (response.success) {
                                // Update button text and class based on new status
                                const newText = newStatus === 'open' ? 'Not Open to Work' : 'Open to Work';
                                const newClass = newStatus === 'open' ? 'btn-success' : 'btn-primary';

                                $('#openToWorkBtn')
                                    .removeClass('btn-primary btn-success')
                                    .addClass(newClass)
                                    .text(newText);
                                
                                // Display the success message
                                Swal.fire(
                                    'Updated!',
                                    response.message,  // Use the message from the response
                                    'success'
                                );
                            } else {
                                Swal.fire(
                                    'Error!',
                                    'Something went wrong.',
                                    'error'
                                );
                            }
                        },
                        error: function() {
                            Swal.fire(
                                'Error!',
                                'Something went wrong.',
                                'error'
                            );
                        }
                    });
                }
            });
        });
    });
  </script>

</body>

</html>






